<!doctype html>
<html class="theme-next use-motion ">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>


    <meta name="description" content="tech and life" />



  <meta name="keywords" content="Hexo,next" />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description" content="tech and life">
<meta property="og:type" content="website">
<meta property="og:title" content="ri0day">
<meta property="og:url" content="http://ri0day.github.io/index.html">
<meta property="og:site_name" content="ri0day">
<meta property="og:description" content="tech and life">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ri0day">
<meta name="twitter:description" content="tech and life">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post'
  };
</script>

  <title> ri0day </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-11099024-2', 'auto');
  ga('send', 'pageview');
</script>




  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">ri0day</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            <i class="menu-item-icon icon-next-categories"></i> <br />
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            标签
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 
  <section id="posts" class="posts-expand">
    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/09/08/python-decorator-file-based-cache/" itemprop="url">
                python decorator - file based cache 
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-09-08T16:38:34+08:00" content="2015-09-08">
            2015-09-08
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/tech/" itemprop="url" rel="index">
                  <span itemprop="name">tech</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/09/08/python-decorator-file-based-cache/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/09/08/python-decorator-file-based-cache/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">import</span> os,pickle,time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cache_disk</span><span class="params">(seconds = <span class="number">900</span>, cache_folder=<span class="string">"/tmp"</span>)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">doCache</span><span class="params">(f)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">inner_function</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            <span class="comment"># calculate a cache key based on the decorated method signature</span></span><br><span class="line">            key = sha1(str(f.__module__) + str(f.__name__) + str(args) + str(kwargs)).hexdigest()</span><br><span class="line">            filepath = os.path.join(cache_folder, key)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># verify that the cached object exists and is less than $seconds old</span></span><br><span class="line">            <span class="keyword">if</span> os.path.exists(filepath):</span><br><span class="line">                modified = os.path.getmtime(filepath)</span><br><span class="line">                age_seconds = time.time() - modified</span><br><span class="line">                <span class="keyword">if</span> age_seconds &lt; seconds:</span><br><span class="line">                    <span class="keyword">return</span> pickle.load(open(filepath, <span class="string">"rb"</span>))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># call the decorated function...</span></span><br><span class="line">            result = f(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># ... and save the cached object for next time</span></span><br><span class="line">            pickle.dump(result, open(filepath, <span class="string">"wb"</span>))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">return</span> inner_function</span><br><span class="line">    <span class="keyword">return</span> doCache</span><br><span class="line"></span><br><span class="line"><span class="decorator">@cache_disk(seconds = 900, cache_folder="/tmp")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_something_time_consuming</span><span class="params">(n,a)</span>:</span></span><br><span class="line">    d = &#123;&#125;</span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line">    d[<span class="string">'name'</span>] = n</span><br><span class="line">    d[<span class="string">'age'</span>] = int(a)</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> do_something_time_consuming(sys.argv[<span class="number">1</span>],sys.argv[<span class="number">2</span>])</span><br></pre></td></tr></table></figure>
<h4 id="let’s_test">let’s test</h4><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">MacBook-Pro:~ min$ time python decorator_cache.py wu 21</span><br><span class="line">&#123;'age': 21, 'name': 'wu'&#125;</span><br><span class="line"></span><br><span class="line">real	<span class="number">0m10.032</span>s</span><br><span class="line">user	<span class="number">0m0.017</span>s</span><br><span class="line">sys	<span class="number">0m0.009</span>s</span><br><span class="line"></span><br><span class="line">MacBook-Pro:~ min$ time python decorator_cache.py wu 21</span><br><span class="line">&#123;'age': 21, 'name': 'wu'&#125;</span><br><span class="line"></span><br><span class="line">real	<span class="number">0m0.028</span>s</span><br><span class="line">user	<span class="number">0m0.017</span>s</span><br><span class="line">sys	<span class="number">0m0.009</span>s</span><br><span class="line">MacBook-Pro:~ min$ time python decorator_cache.py wu 21</span><br><span class="line">&#123;'age': 21, 'name': 'wu'&#125;</span><br><span class="line"></span><br><span class="line">real	<span class="number">0m0.028</span>s</span><br><span class="line">user	<span class="number">0m0.017</span>s</span><br><span class="line">sys	<span class="number">0m0.009</span>s</span><br><span class="line"></span><br><span class="line">MacBook-Pro:~ min$ ls /tmp</span><br><span class="line"><span class="number">33e9d0f6</span>e<span class="number">649a4c122</span>9580fca2b2d9ca<span class="number">3d770731</span>               e<span class="number">92558a7</span>cd5dd<span class="number">5c082f72</span>99486df<span class="number">5516f615</span>c0f0</span><br><span class="line"><span class="number">3412471a14</span>fb<span class="number">92871553580</span><span class="number">53089a7d66</span>b8d9fa</span><br></pre></td></tr></table></figure>
<p>可以看到第二次传入相同参数的时候发现不再需要等10秒就能得到结果了,直接从file cache取到了结果.<br>在tmp目录也看到了对应的key生成的MD5文件名的cache文件.<br>这个装饰器可以适用于缓存比较小的结果集.如果结果集大了,python pickle模块序列化和反序列化一个比较大的对象是比较耗时的.<br>另外,如果做file based cache 可以把目录设置在 内存里面 比如/dev/shm这种里面.会加速i/o .</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/08/31/Eight-Terminal-Utilities-Every-OS-X-Command-Line-User-Should-Know/" itemprop="url">
                Eight Terminal Utilities Every OS X Command Line User Should Know
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-08-31T16:37:12+08:00" content="2015-08-31">
            2015-08-31
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/tech/" itemprop="url" rel="index">
                  <span itemprop="name">tech</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/08/31/Eight-Terminal-Utilities-Every-OS-X-Command-Line-User-Should-Know/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/08/31/Eight-Terminal-Utilities-Every-OS-X-Command-Line-User-Should-Know/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>original post：<a href="http://www.mitchchn.me/2014/os-x-terminal" target="_blank" rel="external">http://www.mitchchn.me/2014/os-x-terminal</a></p>
<h1 id="1-open">1.open</h1><p>1.1 打开一个程序  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open /Applications/Safari.app</span><br></pre></td></tr></table></figure>
<p>1.2 用默认的编辑器打开一个文件  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open <span class="operator">-e</span> mytext.txt</span><br></pre></td></tr></table></figure>
<p>1.3 用finder打开一个目录(.就是当前目录)  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open .</span><br></pre></td></tr></table></figure>
<p>1.4 实际上open比较智能,如果你用open打开一个文件他会用系统默认的程序去打开他,等于双击一个文件<br>比如你打开pdf png 等图片他会自动用系统的preview打开.</p>
<p>另外一个tips 就是如果你在finder中拖动一个文件到terminal里面,会显示这个文件的全路径.</p>
<h1 id="2-_pbcopy_and_pbpaste">2. pbcopy and pbpaste</h1><p>pbcopy能把标准输出暂存到内存中,pbpaste把pbcopy存在内存中的内容输出  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MacBook-Pro:Documents min$ <span class="built_in">echo</span> <span class="string">'my text'</span>|pbcopy</span><br><span class="line">MacBook-Pro:Documents min$ pbpaste    </span><br><span class="line">my text</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MacBook-Pro:Documents min$ pbcopy &lt;realserver</span><br><span class="line">MacBook-Pro:Documents min$ pbpaste</span><br><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># chkconfig: 2345 90 60</span></span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<h1 id="3-_mdfind">3. mdfind</h1><p>mdfind 就是命令行版的spotlight,spotlight能做到的他都能做到.其主要作用就是搜索你想要搜索的一切,包括文件名,文件里面的内容,文件元数据里面的信息等.</p>
<p>####mdfind 查找指定查询范围(-onlyin指定只搜索这个目录里面的内容)：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MacBook-Pro:Documents min$ mdfind -onlyin ~/Downloads/ python</span><br><span class="line">/Users/min/Downloads/goagent/proxy.pac</span><br><span class="line">/Users/min/Downloads/Python%E5%AD%A6%E4%B9%A0%E6%<span class="number">89</span>%<span class="number">8</span>B%E5%<span class="number">86</span>%<span class="number">8</span>C%<span class="number">28</span>%E7%AC%AC4%E7%<span class="number">89</span>%<span class="number">88</span>%<span class="number">29</span>.pdf</span><br><span class="line">/Users/min/Downloads/<span class="number">00</span>_0_0_Percona Live <span class="number">2015</span>/FacebookXDBPerconaLive2015.pdf</span><br><span class="line">/Users/min/Downloads/<span class="number">00</span>_0_0_Percona Live <span class="number">2015</span>/Instant monitoring.pdf</span><br><span class="line">/Users/min/Downloads/<span class="number">00</span>_0_0_Percona Live <span class="number">2015</span>/Bootstrapping databases <span class="keyword">in</span> a single <span class="built_in">command</span>_ elastic provisioning <span class="keyword">for</span> the win.pdf</span><br><span class="line">/Users/min/Downloads/<span class="number">00</span>_0_0_Percona Live <span class="number">2015</span>/Ansible.pdf</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>####mdfind之所以能这么快查找是mdutil这个工具在系统里面对所有文件做了一个索引.mdutil -E可以删除之前的数据重建索引.  </p>
<h1 id="4-_screencapture">4. screencapture</h1><p>screencapture就是截图命令,快捷键就是 cmd + shift + 3   和  cmd + shift + 4  </p>
<p>4.1全屏截图,并打开系统的mail app,把图片贴到邮件内容里面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screencapture -C -M image.png</span><br></pre></td></tr></table></figure>
<p>4.2全屏截图,并用preview打开  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screencapture -C -P image.png</span><br></pre></td></tr></table></figure>
<p>4.3 选择截图,并暂存到剪切版.<br>运行这个命令以后,会弹出一个照相机式的鼠标指针,你可以选择需要截图的窗口,左键选择以后,这张图就存在剪切板里面了,随时可以粘贴了.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screencapture -c -W</span><br></pre></td></tr></table></figure>
<h1 id="5-_launchctl">5. launchctl</h1><p>launchctl 可以让你已命令行的方式与系统的init系统lauchd交互.用launchctl可以控制机器上的服务的开关以及系统启动的时候服务的状态.等同于目前比较流行的linux上的systemd系统下的systemctl</p>
<p>5.1 查看系统启动了哪些服务  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MacBook-Pro:Documents min$ launchctl list</span><br><span class="line">PID	Status	Label</span><br><span class="line">-	<span class="number">0</span>	com.apple.CoreAuthentication.daemon</span><br><span class="line">-	<span class="number">0</span>	com.apple.quicklook</span><br><span class="line">-	<span class="number">0</span>	com.apple.parentalcontrols.check</span><br><span class="line"><span class="number">347</span>	<span class="number">0</span>	com.apple.Finder</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>5.2 launchctl load和unload一个service</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo launchctl load -w /System/Library/LaunchDaemons/org.apache.httpd.plist</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo launchctl unload -w /System/Library/LaunchDaemons/org.apache.httpd.plist</span><br></pre></td></tr></table></figure>
<p>存放系统服务的配置目录有如下: </p>
<ul>
<li>~/Library/LaunchAgents    </li>
<li>/Library/LaunchAgents          </li>
<li>/Library/LaunchDaemons</li>
<li>/System/Library/LaunchAgents</li>
<li>/System/Library/LaunchDaemons</li>
</ul>
<h1 id="6-_say">6. say</h1><p>say 就是一个把输入的文字转换成音频输出,他支持很多语言.  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MacBook-Pro:Documents min$ say <span class="string">"我是你爸爸"</span></span><br><span class="line">MacBook-Pro:Documents min$ say <span class="string">"wtf"</span></span><br></pre></td></tr></table></figure>
<p>读入一个文件,把音频输出成一个文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">say <span class="operator">-f</span> mynovel.txt -o myaudiobook.aiff</span><br></pre></td></tr></table></figure></p>
<h1 id="7-_diskutil">7. diskutil</h1><p>diskutil就是macosx里面的”磁盘工具”的命令行版本.<br>可以格式化,分区,合并分区,添加删除磁盘和分区等.<br>不建议随意使用这个工具,除非你懂你在干什么.</p>
<h1 id="8-_brew">8. brew</h1><p>确切来说brew 就是macosx下的第三方包管理软件,等同于redhat下的yum 和debian下的apt<br>安装brew比较简单</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby <span class="operator">-e</span> <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span></span><br></pre></td></tr></table></figure>
<p>安装完了以后使用就更加简单了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install xxx</span><br><span class="line">brew uninstall xxx</span><br></pre></td></tr></table></figure>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/08/20/the-monitoring-maturity-model-explained/" itemprop="url">
                the monitoring maturity model explained
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-08-20T13:42:33+08:00" content="2015-08-20">
            2015-08-20
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/tech/" itemprop="url" rel="index">
                  <span itemprop="name">tech</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/08/20/the-monitoring-maturity-model-explained/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/08/20/the-monitoring-maturity-model-explained/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>original post: <a href="http://blog.stackstate.com/the-monitoring-maturity-model-explained" target="_blank" rel="external">http://blog.stackstate.com/the-monitoring-maturity-model-explained</a></p>
<p>The pace of change is increasing. Component sizes are shrinking. All the while monitoring solutions are bombarding us with log data, metrics, status reports and alerts. It all scales, but we don’t. How do we prevent from drowning in run-time data?</p>
<p>变化的速度原来越快,组件越来越小,与此同时监控解决方案中log data,metrics,status,report还有alters这些东西也一直轰炸我们,他们的规模都在上涨,而我们却没有,我们如何避免被淹没在这些数据中?</p>
<p>A lot of companies are facing the same problem. They have such a huge amount of data, but can’t get a total unified overview. When problems occur in their IT stack, they don’t know where it originates. Was it a change, an overload, an attack or something else? Based on our experience, we created the <strong>Monitoring Maturity Model</strong>. At which level is your company now?</p>
<p>很多公司都面临同一个问题,他们都有这么多数据,但是无法得到一个完整的概览,当一个问题出现在他们的it环境中,他们不知道哪里是出问题的源头,到底是一次变更,还是负载过高,或者是一次攻击还是其他事情引起的这次故障？根据我们的经验,我们做了一个<strong>监控成熟度的模型</strong>的评估表,看看你的公司现在处于什么级别？</p>
<h4 id="Level_1_-_Health_of_your_components">Level 1 - Health of your components</h4><p>At level one you have different components, but monitor solutions at this level only report if they are up or down. If something happens in your IT stack, you will see a lot of red dots and you will probably get a lot of e-mails which say there is something broken. So at level one you will only see the states and alert notifications per (single) component.</p>
<h4 id="level_1_－_每个被监控组件的健康状态">level 1 － 每个被监控组件的健康状态</h4><p>在1 这个级别,你有不同的被组件,但是你的监控方案只能做到报告这些组件的状态是up 或 down,如果这时候在你的it系统中有一些故障发生,你会看到很多红点警告,还有可能收到很多email,这些email告诉你有些东西坏了.所以在1这个级别你只能看到每个被监控组件的状态,和收到每个被监控组件的报警提醒.</p>
<h4 id="Level_2_-_In-depth_monitoring_on_different_levels">Level 2 - In-depth monitoring on different levels</h4><p>Most of the companies we’ve seen are at level two of the Monitoring Maturity Model. At this level you are monitoring on different levels and from different angles and sources. Tools like Splunk or Kibana are used for log files analysis. Appdynamics or New Relic are used for Application Performance Monitoring. Finally we have tools like Opsview to see the component’s states of different services. And that’s a good thing, because you need all this kind of data. The more data you have, the more insight you have on the different components. So at this level you are able to get more in-depth insight on the systems your own team is using.</p>
<p>But what if something fails somewhere deep down in your IT stack, which affects your team? Any change or minor failure in your IT landscape can create a domino effect and eventually stop the delivery of core business functions. Your team only sees their part of the total stack. For this problem, we introduce level three of the Monitoring Maturity Model.</p>
<h4 id="级别2_－_不同级别的深入监控">级别2 － 不同级别的深入监控</h4><p>我们见到的大多数公司在监控成熟度模型中都处于2级 这个级别,在这个级别,你会从不同的级别和不同的角度还有不同源头分别做监控,像splunk,kibana这些都用来做日志文件分析, Appdynamics 或者New Relic 这些工具用来做应用的性能监控,最后我们会有类似opsview这种工具来看每个被监控组件的不同的服务的状态.这些都是很好的功能,因为你需要所有的这些类型的数据,你数据越多,你会对不同被监控组件的了解越深.所以在这个级别,你会对你的系统有更多的深入了解.</p>
<p>但是,当一个问题发生在你it系统的特别难发现的地方时候,是否会影响到你的team？任何一个变更或一个小的问题在你的整个it系统中可能会造成一种多米诺骨牌效应,最终影响到你核型业务.你的team只能看到整个架构中属于你们的那一部分.对于这个问题,我们就可以介绍一下级别3了.</p>
<p><strong>Monitoring Maturity Model</strong></p>
<p><img src="http://cdn2.hubspot.net/hub/516677/hubfs/Monitor_Maturity_Model_explained.png?t=1439974146337&amp;width=531" alt="img"></p>
<h4 id="Level_3_-_Create_a_total_overview">Level 3 - Create a total overview</h4><p>At level three we don’t only look at all the states, events and metrics but also look at the dependencies and changes. Therefore you need an overview of your whole IT stack, which will be created using existing data from your available tools. To create this overview you will need data from tools like:</p>
<ul>
<li><p>Monitoring tools (AppDynamics, New Relic, Splunk, Graylog2)</p>
</li>
<li><p>IT Management tools (Puppet, Jenkins, ServiceNow, XL-Deploy)</p>
</li>
<li><p>Incident Management tools (Jira, Pagerduty, Topdesk)</p>
</li>
</ul>
<p>Re-use this existing data from different tools to create the total overview of your whole IT stack. At level three you are able to upgrade your entire organization. Now each team can view their team stack as part of the whole IT stack. So teams have a much easier job finding the cause of a failure.  Also teams are now able to find each other when this is needed the most. This level also helps the company to get a unified overview while letting teams decide which tools they want/need to use.</p>
<h4 id="级别3_-_做一个完整的概览">级别3 - 做一个完整的概览</h4><p>在级别3这个阶段,我们不不仅要看所有的stats,event,metrics,而且还要看每个被监控对象的依赖对象以及每个东西的变更.所以你需要有一个利用你现在所有数据和工具做出来的整个架构的概览.要做这个概览你需要类似这些类型的数据和工具</p>
<ul>
<li>监控工具(ppDynamics, New Relic, Splunk, Graylog2) </li>
<li>it 管理工具(Puppet, Jenkins, ServiceNow, XL-Deploy)</li>
<li>事件管理工具(Jira, Pagerduty, Topdesk)</li>
</ul>
<p>重用这些以有工具生成的已有数据去生存一个整个系统的完整概览.在级别3,你能升级你的整个组织结构了.现在每个team能以全局的视角看到每个team自己的那一部分.现在这些team能在出问题的时候更容易找到问题发生的原因.而且现在这些team也可以在需要的时候找别的team.让每个team决定他们自己自己需要用活着想用的工具能帮助公司得到一个完整统一的系统概览.</p>
<h4 id="Level_4_-_Automated_operations">Level 4 - Automated operations</h4><p>Level four is part of our bigger vision, at this level we will be able to:<br>Send alerts before there is a failure<br>Self-heal by for example scaling up or rerouting services before a service is overloaded<br>Abnormality detection<br>Advanced signal processing</p>
<h4 id="级别4_-_自动化操作">级别4 - 自动化操作</h4><p>级别4是我们大前景的的一部分,在这个级别,我们可以:<br>在发生故障之前发送报警<br>自动修复,在负载过高的时候,自动扩展或者动态重新路由.<br>异常行为检测<br>高级信号处理  </p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/08/19/hello-world/" itemprop="url">
                Hello World
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-08-19T16:10:02+08:00" content="2015-08-19">
            2015-08-19
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/08/19/hello-world/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/08/19/hello-world/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick_Start">Quick Start</h2><h3 id="Create_a_new_post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
 </div>

        

        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Ri0day" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Ri0day</p>
        </div>
        <p class="site-description motion-element" itemprop="description">tech and life</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">4</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">1</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">3</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ri0day</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ri0day"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     
  	<script src="/js/ua-parser.min.js"></script>
  	<script src="/js/hook-duoshuo.js"></script>
  

    
  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
